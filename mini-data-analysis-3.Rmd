---
title: Mini Data Analysis 3
author: Jana Osea
date: October 28, 2021
output: github_document
---

# Setup

Begin by loading your data and the tidyverse package below: 

```{r, message = FALSE}
suppressPackageStartupMessages(library(datateachr)) # <- might contain the data you picked!
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(forcats))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(ggridges))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(kableExtra))
suppressPackageStartupMessages(library(lubridate))
suppressPackageStartupMessages(library(broom))
```

After loading the appropriate packages, I load the data as processed in the previous milestone.

```{r}
# LOAD DATA
# count number of amenities by splitting words
no_of_amenities <- rep(0, nrow(apt_buildings))
for(i in 1:nrow(apt_buildings)) {
  amenities = apt_buildings$amenities[i]
  if(!is.na(amenities)) {
    no_of_amenities[i] = length(str_split(amenities, " ,")[[1]])
  }
}

# determine outliers
outliers <- boxplot.stats(apt_buildings$no_of_units)$out 


# bind the number of amenities as a new column in the apt_buildings tibble df
cbind(apt_buildings, no_of_amenities) -> apt_buildings

apt_buildings %>%
  select(id,
         no_of_amenities,
         property_type,
         visitor_parking,
         ward,
         year_built,
         `non-smoking_building`,
         no_of_units,
         pets_allowed,
         heating_type,
         balconies,
         air_conditioning
         ) %>%
  filter(!no_of_units %in% outliers) %>%
  mutate(year_built = year(as_date(year_built)))-> apt_buildings
```

## Research Questions

1. Is there a downward or upward trend in the number non-smoking units built from 1910 to 2020? 
2. Does the number of amenities change by ward and by smoking building type? Is there an interaction between smoking building type and ward on the number of amenities?


# Exercise 1: Special Data Types

**Task 1**: I choose to reorder the column *ward* in the *apt_building* data set so that I am able to better visualize which wards have more total number of amenities. It also allows us to see which wards have similar total number of amenities.

```{r}
apt_buildings %>%
  group_by(ward) %>%
  summarise(no_of_amenities = sum(no_of_amenities)) %>%
  mutate(ward = fct_reorder(ward, no_of_amenities)) %>%
  ggplot(aes(x=ward, y=no_of_amenities, color=ward, fill=ward)) + 
  geom_bar(stat="identity", alpha=0.2) + 
  ggtitle("Number of Amenities by Ward")

apt_buildings %>%
  group_by(ward) %>%
  summarise(no_of_amenities = sum(no_of_amenities)) %>%
  mutate(ward = fct_reorder(ward, no_of_amenities)) -> apt_buildings1
```


**Task 2**: The column *visitor_parking* column has *UNAVAILABLE* as an option, however there are also data points with *NA* as input. Hence, I used the `fct_collapse` along with `addNA` function in order to combine the *UNAVAILABLE*  option with the *NA* option. This allows us to still include the number of NA's into the analysis. 

```{r}
# create tibble 
apt_buildings %>%
  group_by(ward, visitor_parking) %>%
  summarise(no_of_amenities = sum(no_of_amenities), 
            no_of_unit = sum(no_of_units)) -> apt_buildings2


# change factor levels to be reordered the same as task 1 
apt_buildings2$ward <- factor(apt_buildings2$ward, 
                              levels(apt_buildings1$ward))

apt_buildings2$visitor_parking <-  fct_reorder(factor(apt_buildings2$visitor_parking), 
            apt_buildings2$no_of_amenities)

# plot num of amenities by ward and visitor parking 
apt_buildings2 %>% 
  ggplot(aes(x=ward, y=no_of_amenities, fill=visitor_parking, color=visitor_parking)) +
  geom_bar(stat="identity", alpha=0.2) +
  ggtitle("Number of Amenities by Ward and by Visitor Parking")
```

# Exercise 2: Modelling

## 2.0

**Research Question**: Does the number of amenities change by ward and by smoking building type? Is there an interaction between smoking building type and ward on the number of amenities?

**Variable of interest**: Number of amenities

## 2.1 

I will perform a TWO-way ANOVA to test if:

1. there is a difference in the mean number of amenities at any level of the ward variable.
2. there is a difference in the mean number of amenities at any level of the smoking building type variable.
3. the effect of the ward variable does depend on the effect of the smoking building type variable (a.k.a. interaction effect).

The code to perform the test and the output is shown below.

```{r}
my_aov <- aov(no_of_amenities ~ ward * `non-smoking_building`, 
              data=apt_buildings)
my_aov
```


## 2.2

I will use the *p*-value as a way to determine the results of the test using the `broom` package. 

```{r}
my_aov_tidy <- tidy(my_aov)
my_aov_tidy
my_aov_tidy$p.value
```

Using an $\alpha=0.05$, we conclude that the first and third *p*-values are significant. Hence, we conclude that:

-  the mean number of amenities is not the same for at least one ward level 
- there is an interaction effect; the effect of the ward variable on the mean number of amenities is affected by the effect of the smoking building type


# Exercise 3: Reading and writing data

Get set up for this exercise by making a folder called `output` in the top level of your project folder / repository. You'll be saving things there. 

## 3.1 (5 points)

Take a summary table that you made from Milestone 2 (Exercise 1.2), and write it as a csv file in your `output` folder. Use the `here::here()` function.

- **Robustness criteria**: You should be able to move your Mini Project repository / project folder to some other location on your computer, or move this very Rmd file to another location within your project repository / folder, and your code should still work.
- **Reproducibility criteria**: You should be able to delete the csv file, and remake it simply by knitting this Rmd file. 
  

## 3.2 (5 points)

Write your model object from Exercise 2 to an R binary file (an RDS), and load it again. Be sure to save the binary file in your `output` folder. Use the functions `saveRDS()` and `readRDS()`. 

- The same robustness and reproducibility criteria as in 3.1 apply here.

<!-------------------------- Start your work below ---------------------------->


<!----------------------------------------------------------------------------->

# Tidy Repository

Now that this is your last milestone, your entire project repository should be organized. Here are the criteria we're looking for.

## Main README (3 points)

There should be a file named `README.md` at the top level of your repository. Its contents should automatically appear when you visit the repository on GitHub. 

Minimum contents of the README file:

- In a sentence or two, explains what this repository is, so that future-you or someone else stumbling on your repository can be oriented to the repository.
- In a sentence or two (or more??), briefly explains how to engage with the repository. You can assume the person reading knows the material from STAT 545A. Basically, if a visitor to your repository wants to explore your project, what should they know?

Once you get in the habit of making README files, and seeing more README files in other projects, you'll wonder how you ever got by without them! They are tremendously helpful.

## File and Folder structure (3 points)

You should have at least four folders in the top level of your repository: one for each milestone, and one output folder. If there are any other folders, these are explained in the main README.

Each milestone document is contained in its respective folder, and nowhere else. 

Every level-1 folder (that is, the ones stored in the top level, like "Milestone1" and "output") has a `README` file, explaining in a sentence or two what is in the folder, in plain language (it's enough to say something like "This folder contains the source for Milestone 1").

